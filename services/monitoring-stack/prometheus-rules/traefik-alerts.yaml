apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: traefik-alerts
  namespace: monitoring
  labels:
    release: kube-prometheus-stack
spec:
  groups:
    - name: traefik-alerts
      rules:
        - alert: TraefikDown
          expr: up{job="traefik"} == 0
          for: 2m
          labels:
            severity: critical
          annotations:
            summary: "Traefik is down"
            description: "Traefik instance on {{ $labels.node }} has been unreachable for more than 2 minutes."

        - alert: TraefikHighErrorRate
          expr: sum(rate(traefik_service_requests_total{code=~"5.."}[5m])) / sum(rate(traefik_service_requests_total[5m])) * 100 > 5
          for: 5m
          labels:
            severity: warning
          annotations:
            summary: "Traefik high 5xx error rate"
            description: 'Traefik 5xx error rate is {{ $value | printf "%.2f" }}% (threshold: 5%).'
