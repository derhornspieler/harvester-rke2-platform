apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: vault-alerts
  namespace: monitoring
  labels:
    release: kube-prometheus-stack
spec:
  groups:
    - name: vault-alerts
      rules:
        - alert: VaultSealed
          expr: vault_core_unsealed == 0
          for: 2m
          labels:
            severity: critical
          annotations:
            summary: "Vault instance is sealed"
            description: "Vault instance {{ $labels.instance }} has been sealed for more than 2 minutes."

        - alert: VaultDown
          expr: up{job="vault"} == 0
          for: 2m
          labels:
            severity: critical
          annotations:
            summary: "Vault is down"
            description: "Vault instance {{ $labels.instance }} has been unreachable for more than 2 minutes."

        - alert: VaultLeaderLost
          expr: vault_core_active == 0 and on() count(up{job="vault"} == 1) > 0
          for: 10m
          labels:
            severity: critical
          annotations:
            summary: "Vault has no active leader"
            description: "No Vault instance is reporting as the active leader for more than 10 minutes."
