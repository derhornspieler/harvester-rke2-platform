# Helm values for GitLab shared (instance-wide) runner
# Chart: gitlab/gitlab-runner
# Docs: https://docs.gitlab.com/runner/install/kubernetes.html

replicas: 1

## GitLab instance URL â€” runner registers here
gitlabUrl: https://gitlab.example.com

## Runner configuration
runners:
  config: |
    [[runners]]
      name = "shared-k8s-runner"
      executor = "kubernetes"
      [runners.kubernetes]
        namespace = "gitlab-runners"
        image = "alpine:3.21"
        service_account = "gitlab-runner-sa"
        pull_policy = ["if-not-present"]
        [runners.kubernetes.node_selector]
          "workload-type" = "compute"
        [runners.kubernetes.volumes]
          [[runners.kubernetes.volumes.config_map]]
            name = "vault-root-ca"
            mount_path = "/etc/ssl/certs/vault-root-ca.pem"
            sub_path = "ca.crt"
            read_only = true
        [runners.kubernetes.pod_labels]
          "app.kubernetes.io/managed-by" = "gitlab-runner"

  ## Tags applied to this runner
  tags: "shared,kubernetes,compute"

## Runner pod node selector (the runner manager pod itself)
nodeSelector:
  workload-type: general

## Service account for the runner manager pod
serviceAccountName: gitlab-runner-sa

## Mount Root CA into the runner manager pod for GitLab TLS trust
volumeMounts:
  - name: vault-root-ca
    mountPath: /etc/ssl/certs/vault-root-ca.pem
    subPath: ca.crt
    readOnly: true

volumes:
  - name: vault-root-ca
    secret:
      secretName: gitlab-runner-certs

## Resource limits for the runner manager pod
resources:
  requests:
    cpu: 100m
    memory: 128Mi
  limits:
    cpu: 500m
    memory: 256Mi
