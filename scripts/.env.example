# RKE2 Cluster Deployment Configuration
# =======================================
# Copy to scripts/.env and customize, OR leave empty to auto-generate.
# deploy-cluster.sh will generate random values for any unset variables.
#
# Usage:
#   cp scripts/.env.example scripts/.env
#   # Edit values as needed (or leave blank for auto-generation)
#   ./scripts/deploy-cluster.sh

# ---- Domain Configuration ----
# Root domain for all service FQDNs (e.g., vault.DOMAIN, harbor.DOMAIN)
# Defaults to "example.com" if left empty
DOMAIN=""

# Organization name for PKI CA Common Names (e.g., "Example Org", "Tiger Inc")
# Auto-derived from DOMAIN if empty (example.com → "Example Org")
ORG_NAME=""

# Keycloak realm name (auto-derived from DOMAIN if empty: example.com → "example")
KC_REALM=""

# Git repo URL for ArgoCD bootstrap (default: git@gitlab.${DOMAIN}:infrastructure/rke2-cluster.git)
GIT_REPO_URL=""

# ---- Feature Flags ----
# Uptime Kuma status page (default: enabled)
DEPLOY_UPTIME_KUMA="true"

# LibreNMS network monitoring (default: disabled — requires MariaDB Operator)
DEPLOY_LIBRENMS="false"

# ---- Airgapped Mode ----
# Set AIRGAPPED=true for fully offline deployments
AIRGAPPED="false"

# Bootstrap registry — pre-existing external registry for Phases 0-3.
# Required when AIRGAPPED=true. Must contain RKE2 system images, Helm charts (OCI),
# and all container images for Phases 0-4 (before in-cluster Harbor exists).
# Format: hostname[:port] (no protocol prefix)
# Example: "registry.local:5000" or "bootstrap.corp.internal"
BOOTSTRAP_REGISTRY=""

# Harbor proxy-cache upstream registry (used by Harbor after Phase 4)
# In most airgapped deployments, this equals BOOTSTRAP_REGISTRY
UPSTREAM_PROXY_REGISTRY=""

# Optional: PEM-encoded CA cert for bootstrap registry TLS (if self-signed)
BOOTSTRAP_REGISTRY_CA_PEM=""

# Optional: authentication for bootstrap registry
BOOTSTRAP_REGISTRY_USERNAME=""
BOOTSTRAP_REGISTRY_PASSWORD=""

# Private RPM repo mirrors (required when AIRGAPPED=true)
# PRIVATE_ROCKY_REPO_URL=""
# PRIVATE_RKE2_REPO_URL=""

# Per-chart OCI URL overrides — point to bootstrap registry or Harbor OCI
# Example: HELM_OCI_CERT_MANAGER="oci://registry.local:5000/charts/cert-manager"
# HELM_OCI_CERT_MANAGER=""
# HELM_OCI_CNPG=""
# HELM_OCI_VAULT=""
# HELM_OCI_HARBOR=""
# HELM_OCI_KPS=""

# ---- Cloud-Init Override ----
# Optional paths to custom cloud-init YAML files for Terraform.
# Leave empty to use the built-in templates in machine_config.tf.
# Paths are relative to the cluster/ directory or absolute.
USER_DATA_CP_FILE=""
USER_DATA_WORKER_FILE=""

# ---- Credentials ----
# Keycloak bootstrap client secret (used for initial realm setup)
KEYCLOAK_BOOTSTRAP_CLIENT_SECRET=""

# Keycloak PostgreSQL password
KEYCLOAK_DB_PASSWORD=""

# Mattermost PostgreSQL password
MATTERMOST_DB_PASSWORD=""

# Mattermost MinIO credentials
MATTERMOST_MINIO_ROOT_USER=""
MATTERMOST_MINIO_ROOT_PASSWORD=""

# Harbor Redis/Valkey password
HARBOR_REDIS_PASSWORD=""

# Grafana admin password
GRAFANA_ADMIN_PASSWORD=""

# Basic-auth password for Prometheus, Hubble, Rollouts dashboards
BASIC_AUTH_PASSWORD=""

# htpasswd hash (auto-generated from BASIC_AUTH_PASSWORD if empty)
# Format: admin:$2y$05$...
BASIC_AUTH_HTPASSWD=""

# LibreNMS credentials (only needed if DEPLOY_LIBRENMS=true)
LIBRENMS_DB_PASSWORD=""
LIBRENMS_VALKEY_PASSWORD=""

# Harbor admin + storage passwords
HARBOR_ADMIN_PASSWORD=""
HARBOR_MINIO_SECRET_KEY=""
HARBOR_DB_PASSWORD=""

# Kasm Workspaces PostgreSQL passwords
KASM_PG_SUPERUSER_PASSWORD=""
KASM_PG_APP_PASSWORD=""

# Keycloak bootstrap admin password
KC_ADMIN_PASSWORD=""

# ---- External Services ----
# GitLab API token (optional — for automated deploy key setup)
GITLAB_API_TOKEN=""

# ---- GitLab Runner Configuration ----
# Runner authentication tokens (populated automatically by setup-gitlab-services.sh Phase 8)
GITLAB_RUNNER_SHARED_TOKEN=""
GITLAB_RUNNER_GROUP_TOKEN=""

# GitLab Runner Helm chart OCI override (airgapped only)
# Upstream: https://charts.gitlab.io — chart: gitlab-runner
HELM_OCI_GITLAB_RUNNER=""

# ---- Feature Flags (continued) ----
# DHI Builder — hardened image pipeline (requires Harbor + ArgoCD)
DEPLOY_DHI_BUILDER="false"

# Deploy dedicated security scanner runners (Phase 15)
DEPLOY_CICD_SECURITY_RUNNERS="true"

# Deploy demo applications — NetOps Arcade (Phase 17)
DEPLOY_DEMO_APPS="true"

# Demo echo server chaos rate (0=clean deploys, 30=rollback demo)
DEMO_ECHO_CHAOS_RATE="0"

# ---- Airgapped OCI Chart Overrides (continued) ----
# Argo Workflows chart (upstream: oci://ghcr.io/argoproj/argo-helm/argo-workflows)
HELM_OCI_ARGO_WORKFLOWS=""

# Argo Events chart (upstream: oci://ghcr.io/argoproj/argo-helm/argo-events)
HELM_OCI_ARGO_EVENTS=""

# External Secrets Operator chart (upstream: https://charts.external-secrets.io)
HELM_OCI_EXTERNAL_SECRETS=""

# ---- Binary/CRD Download URL Overrides (airgapped) ----
# Point these to a self-hosted GitLab generic package registry, Nexus, or any HTTP mirror.
# Defaults point to GitHub releases. In airgapped mode these MUST point to internal mirrors.
#
# Example (GitLab generic package registry):
#   BINARY_URL_ARGOCD_CLI="https://gitlab.example.com/api/v4/projects/42/packages/generic/argocd/v2.14.0/argocd-linux-amd64"
#   BINARY_URL_KUSTOMIZE="https://gitlab.example.com/api/v4/projects/42/packages/generic/kustomize/v5.6.0/kustomize_v5.6.0_linux_amd64.tar.gz"
#
# Example (raw repo):
#   BINARY_URL_ARGOCD_CLI="https://gitlab.example.com/infra/binaries/-/raw/main/argocd-linux-amd64"

# ArgoCD CLI (upstream: https://github.com/argoproj/argo-cd/releases/latest/download/argocd-linux-amd64)
BINARY_URL_ARGOCD_CLI=""

# Kustomize (upstream: https://github.com/kubernetes-sigs/kustomize/releases/download/kustomize/v5.6.0/...)
BINARY_URL_KUSTOMIZE=""

# kubeconform (upstream: https://github.com/yannh/kubeconform/releases/download/v0.6.7/...)
BINARY_URL_KUBECONFORM=""

# CRD JSON schema catalog base URL (upstream: https://raw.githubusercontent.com/datreeio/CRDs-catalog/main)
# Used by kubeconform for schema validation in CI pipelines
CRD_SCHEMA_BASE_URL=""

# Gateway API CRD YAML (upstream: https://github.com/kubernetes-sigs/gateway-api/releases/download/v1.3.0/standard-install.yaml)
# Alternative: pre-download to crds/gateway-api-v1.3.0-standard-install.yaml (auto-detected in airgapped mode)
GATEWAY_API_CRD_URL=""

# Argo Rollouts Gateway API plugin (upstream: https://github.com/argoproj-labs/...)
ARGO_ROLLOUTS_PLUGIN_URL=""
